<?xml version="1.0" encoding="utf-8" ?>
<Imaginet>

	<Function unit="Imaginet.Units.Signal.FftShift">
		<DisplayName>FFT Shift</DisplayName>
		<DisplayPath>/Signal Processing/Frequency Domain</DisplayPath>

		<Description>
			<Header>Description</Header>
			Center the zero-frequency component in the spectrum by swapping the two halves along a specified axis.
			
			This unit rearranges FFT output to place the DC component (zero frequency) at the center instead of the edges. It swaps the first half with the second half of the data along the specified axis, converting from FFT's natural ordering (where frequencies wrap around) to a centered ordering that's more intuitive for visualization and analysis.
			
			The axis dimension size must be a power of 2. Input can be multi-dimensional with the shift applied to one axis at a time. Axes are enumerated from right to left (0 is rightmost dimension).
			
			Supports float32, Q31, and Q15 data types.

			<Header>Usage</Header>
			Use the FFT Shift unit to center frequency spectra for visualization, prepare data for filters designed for centered spectra, or rearrange FFT output for frequency-domain analysis.

			<Header>Python implementation</Header>
			<Inline fragment="fft_shift.py:fft_shift_py" language="Python" />
		</Description>

		<Parameters>
			<InputSocket name="input" pipe="data" description="Input tensor containing FFT output or frequency-domain data. Must be at least 1D. The specified axis dimension must have a size that is a power of 2. Supports float32, Q31, and Q15 data types." />
			<Int32Option name="axis" min="0" max="9" ui="textbox" text="Axis" description="Axis along which to perform the FFT shift, enumerated from right to left (0 is the rightmost dimension). The size along this axis must be a power of 2." />
			<OutputSocket name="output" type="input.type" shape="input.shape" pipe="data" description="Shifted tensor with zero-frequency component centered along the specified axis. Has the same shape and data type as input." />

			<Expression name="d0" value="input.shape.step(axis)" description="Stride along the shift axis in the input tensor." />
			<Expression name="d1" value="input.shape.size(axis)" description="Size of the shift axis dimension (must be power of 2)." />
			<Expression name="d2" value="input.shape.slot(axis)" description="Number of slices orthogonal to the shift axis." />
		</Parameters>

		<Contracts>
			<Assert test="axis &lt; input.shape.count" error="Axis must be less then the number of input dimensions." />
			<Assert test="input.shape.size(axis) == Math.pow(2, Math.floor(Math.log(input.shape.size(axis), 2)))" error="Size of axis dimension must be the power of two." />
		</Contracts>

		<Implementations>
			<Implementation language="C" fragment="fft_shift.h:fft_shift_f32" call="fft_shift_f32(input, output, d0, d1, d2)">
				<Conditional value="input.type == System.Float32" />
			</Implementation>
			<Implementation language="C" fragment="fft_shift.h:fft_shift_q31" call="fft_shift_q31(input, output, d0, d1, d2)">
				<Conditional value="input.type == System.Q31" />
			</Implementation>
			<Implementation language="C" fragment="fft_shift.h:fft_shift_q15" call="fft_shift_q15(input, output, d0, d1, d2)">
				<Conditional value="input.type == System.Q15" />
			</Implementation>
			<Implementation language="Python" fragment="fft_shift.py:fft_shift_py" call="fft_shift(input, output, axis)" />
		</Implementations>
	</Function>

</Imaginet>