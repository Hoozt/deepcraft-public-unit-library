<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Imaginet version="2.0.0.0">
	<Compound unit="Imaginet.Units.Signal.ContextualWindow">
		<DisplayName>Contextual Window (Sliding Window)</DisplayName>
		<DisplayPath>/Signal Processing/Time Domain</DisplayPath>
		<Description>
			<Header>Description</Header>
			Create overlapping time windows from streaming data with automatic window shape and stride calculation based on temporal context length and prediction frequency.
			
			This compound unit wraps the Sliding Window unit, automatically computing window shape from contextual length (in seconds) and stride from desired prediction frequency (in Hz). Window shape is determined as contextual_length × sample_rate, and stride is computed as sample_rate / prediction_frequency. Input validation ensures prediction frequency is feasible given the window length and sample rate.

			<Header>Usage</Header>
			Use the Contextual Window unit to prepare temporal sequences for time-series models, sliding window inference, or real-time stream processing where you want to specify timing in intuitive units.
		</Description>
		<Nodes>
			<TensorInputNode id="node_2" x="-214.1624965807523" y="418.45896808347914" enabled="true" name="Input" param="input">
				<Description>Streaming input data to be windowed. Sample rate is extracted from tensor metadata to compute window parameters.</Description>
			</TensorInputNode>
			<AssertNode id="node_8" x="231.4075274273731" y="365.09478755435856" enabled="true" name="Validation">
				<Inputs>
					<Input param="Length" type="Real" />
					<Input param="PredictionFreq" type="Real" />
					<Input param="Input" type="Tensor" />
				</Inputs>
				<Tests>
					<Test assert="1/Length &gt; PredictionFreq" error="Prediction frequency {PredictionFreq} Hz is too low. Min is {1/Length} Hz" />
					<Test assert="Input.rate &lt; PredictionFreq" error="Prediction frequency {PredictionFreq} Hz is too high. Max is {Input.rate} Hz" />
					<Test assert="Length &lt; 1.0/Input.rate" error="Window length {Length} seconds is too low. Min is {1.0/Input.rate} seconds when sample frequency is {Input.rate} Hz." />
				</Tests>
			</AssertNode>
			<UnitNode id="node_5" x="559.984415056384" y="392.8727820886581" enabled="true" unit="Imaginet.Units.Signal.SlidingWindow">
				<ShapeArgument param="window_shape">[128,3]</ShapeArgument>
				<Int32Argument param="stride">3</Int32Argument>
			</UnitNode>
			<DoubleOptionNode id="node_1" x="-212.2057634896463" y="728.9346362934346" enabled="true" name="Prediction Frequency (Hz)" param="prediction_freq">
				<Description>Desired output rate in Hz. Determines window stride. Must be less than sample rate and greater than 1/contextual_length.</Description>
				<DefaultValue>10</DefaultValue>
				<MinValue>0</MinValue>
				<MaxValue>1000</MaxValue>
			</DoubleOptionNode>
			<TensorOutputNode id="node_3" param="output" x="951.783466097944" y="419.5837800243739" enabled="true" name="Output">
				<Description>Windowed output with shape extended by the temporal dimension. Output rate matches prediction frequency.</Description>
			</TensorOutputNode>
			<ExpressionNode id="node_7" x="206.34147860756116" y="140.99368605768473" enabled="true" name="Window Shape">
				<Expression type="Shape" output="Output">Input.shape.insert(-1, Math.round(Length * Input.rate))</Expression>
				<Input param="Length" type="Real" />
				<Input param="Input" type="Tensor" />
			</ExpressionNode>
			<DoubleOptionNode id="node_0" x="-157.37316394442894" y="173.4480179348942" enabled="true" name="Length (seconds)" param="contextual_length_sec">
				<Description>Temporal context length in seconds. Defines how much historical data each window contains. Must be greater than 1/sample_rate.</Description>
				<DefaultValue>2</DefaultValue>
				<MinValue>0</MinValue>
				<MaxValue>100</MaxValue>
			</DoubleOptionNode>
			<ExpressionNode id="node_6" x="175.31382005687215" y="673.2420859923243" enabled="true" name="Stride">
				<Expression type="Integer" output="Output">Input.shape.flat * Math.round(Input.rate/PredictionFreq)</Expression>
				<Input param="PredictionFreq" type="Real" />
				<Input param="Input" type="Tensor" />
			</ExpressionNode>
		</Nodes>
		<Connections>
			<Connection>
				<Source node="node_5" param="output" />
				<Target node="node_3" param="value" />
			</Connection>
			<Connection>
				<Source node="node_6" param="output" />
				<Target node="node_5" param="stride" />
			</Connection>
			<Connection>
				<Source node="node_2" param="value" />
				<Target node="node_6" param="Input" />
			</Connection>
			<Connection>
				<Source node="node_1" param="value" />
				<Target node="node_6" param="PredictionFreq" />
			</Connection>
			<Connection>
				<Source node="node_2" param="value" />
				<Target node="node_5" param="input" />
			</Connection>
			<Connection>
				<Source node="node_0" param="value" />
				<Target node="node_7" param="Length" />
			</Connection>
			<Connection>
				<Source node="node_7" param="output" />
				<Target node="node_5" param="window_shape" />
			</Connection>
			<Connection>
				<Source node="node_2" param="value" />
				<Target node="node_7" param="Input" />
			</Connection>
			<Connection>
				<Source node="node_0" param="value" />
				<Target node="node_8" param="Length" />
			</Connection>
			<Connection>
				<Source node="node_1" param="value" />
				<Target node="node_8" param="PredictionFreq" />
			</Connection>
			<Connection>
				<Source node="node_2" param="value" />
				<Target node="node_8" param="Input" />
			</Connection>
		</Connections>
	</Compound>
</Imaginet>