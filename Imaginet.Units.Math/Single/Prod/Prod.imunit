<?xml version="1.0" encoding="utf-8" ?>
<Imaginet>
	<Unit name="Imaginet.Units.Math.Prod">
		<DisplayName>Product</DisplayName>
		<DisplayPath>/Math/Tensor Reductions</DisplayPath>

		<Description>
			<Header>Description</Header>
			Calculate the product of all values along a specified axis, reducing the tensor by multiplying elements.
			
			This unit multiplies all values along the chosen axis together. For each slice along the specified axis, it computes the product of all elements. The output shape is the same as the input shape with the selected axis removed.
			
			Currently supports float32 data type. Requires input to have at least 2 dimensions.

			<Header>Usage</Header>
			Use the Product unit when you need to compute cumulative multiplication across a dimension, such as calculating geometric means or combining probability factors.

			<Header>Python implementation</Header>
			<Inline fragment="prod.py:prod" language="Python" />
		</Description>

		<Parameters>
			<InputSocket name="input" description="Input tensor to compute products from. Supports float32 data type only. Must have at least 2 dimensions." />
			<Int32Option name="axis" min="0" max="9" ui="textbox" text="Axis" description="Axis along which to compute products. Axes are enumerated from right to left." />
			<OutputSocket name="output" shape="input.shape.remove(axis)" type="input.type" description="Output tensor containing product values. Has the same shape as input with the selected axis removed."  />

			<Expression name="d0" value="input.shape.step(axis)" description="Step size for iterating along the reduction axis." />
			<Expression name="d1" value="input.shape.size(axis)" description="Size of the axis dimension being reduced (number of elements to multiply)." />
			<Expression name="d2" value="input.shape.slot(axis)" description="Number of slots (iterations) in the reduction operation." />
		</Parameters>

		<Contracts>
			<Assert test="input.shape.count &gt;= 2" error="Prod requires an input with two or more dimensions since it reduces one dimension." />
			<Assert test="axis &lt; input.shape.count" error="Axis must be less that number of input dimensions." />
		</Contracts>

		<Implementations>
			<Implementation language="C" fragment="prod.h:prod_f32" call="prod_f32(input, d0, d1, d2, output)">
				<Conditional value="input.type == System.Float32" />
			</Implementation>
			<Implementation language="Python" fragment="prod.py:prod" call="prod(input, axis, output)" />
		</Implementations>

	</Unit>
</Imaginet>